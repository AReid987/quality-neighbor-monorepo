"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1],{46160:function(e,t,a){a.d(t,{AuthProvider:function(){return U},aC:function(){return f}});var n,o,i,r,s=a(59354),c=a(29057),l=a(90524),u=a(9835);let d={domain:u.env.NEXT_PUBLIC_AUTH0_DOMAIN||u.env.AUTH0_DOMAIN,clientId:u.env.NEXT_PUBLIC_AUTH0_CLIENT_ID||u.env.AUTH0_CLIENT_ID,audience:u.env.NEXT_PUBLIC_AUTH0_AUDIENCE||u.env.AUTH0_AUDIENCE,scope:"openid profile email",redirectUri:"".concat(window.location.origin,"/api/auth/callback")};function h(e,t){var a,n;return(null===(n=e.app_metadata)||void 0===n?void 0:null===(a=n.projects)||void 0===a?void 0:a.includes(t))||!1}(n=i||(i={})).QN_RESIDENT="qn:resident",n.QN_BUSINESS_OWNER="qn:business_owner",n.QN_INTERNAL_ADMIN="qn:internal_admin",n.QN_INTERNAL_MANAGER="qn:internal_manager",n.QN_INTERNAL_AGENT="qn:internal_agent",n.RLTR_AGENT="rltr:agent",n.RLTR_ADMIN="rltr:admin",n.SUPER_ADMIN="super:admin",(o=r||(r={})).QN="qn",o.RLTR_MKTG="rltr_mktg",d.domain,d.clientId,d.audience,d.scope,d.redirectUri,a(29713);var p=a(87255),_=a(9835);let T={domain:_.env.AUTH0_DOMAIN||"",clientId:_.env.AUTH0_CLIENT_ID||"",clientSecret:_.env.AUTH0_CLIENT_SECRET||"",baseURL:_.env.AUTH0_BASE_URL||"",secret:_.env.AUTH0_SECRET||"",issuerBaseURL:"https://".concat(_.env.AUTH0_DOMAIN||""),audience:_.env.AUTH0_AUDIENCE||"https://".concat(_.env.AUTH0_DOMAIN||"","/api/v2/")};p.Ry({sub:p.Z_(),email:p.Z_().email(),name:p.Z_().optional(),nickname:p.Z_().optional(),picture:p.Z_().url().optional(),given_name:p.Z_().optional(),family_name:p.Z_().optional(),locale:p.Z_().optional(),updated_at:p.Z_().optional(),email_verified:p.O7().optional()});class A{async getAccessToken(){if(this.accessToken&&this.tokenExpiry&&Date.now()<this.tokenExpiry)return this.accessToken;let e=await fetch("https://".concat(this.domain,"/oauth/token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:this.clientId,client_secret:this.clientSecret,audience:"https://".concat(this.domain,"/api/v2/"),grant_type:"client_credentials"})});if(!e.ok)throw Error("Failed to get Auth0 management token: ".concat(e.statusText));let t=await e.json();if(this.accessToken=t.access_token,this.tokenExpiry=Date.now()+1e3*t.expires_in-6e4,!this.accessToken)throw Error("Failed to retrieve access token from Auth0");return this.accessToken}async updateUserMetadata(e,t){let a=await this.getAccessToken(),n=await fetch("https://".concat(this.domain,"/api/v2/users/").concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({app_metadata:t})});if(!n.ok)throw Error("Failed to update user metadata: ".concat(n.statusText));return n.json()}async getUserMetadata(e){let t=await this.getAccessToken(),a=await fetch("https://".concat(this.domain,"/api/v2/users/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(!a.ok)throw Error("Failed to get user metadata: ".concat(a.statusText));return a.json()}async assignRoles(e,t){let a=await this.getAccessToken(),n=await fetch("https://".concat(this.domain,"/api/v2/users/").concat(e,"/roles"),{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({roles:t})});if(!n.ok)throw Error("Failed to assign roles: ".concat(n.statusText));return n.json()}async getUserRoles(e){let t=await this.getAccessToken(),a=await fetch("https://".concat(this.domain,"/api/v2/users/").concat(e,"/roles"),{headers:{Authorization:"Bearer ".concat(t)}});if(!a.ok)throw Error("Failed to get user roles: ".concat(a.statusText));return a.json()}async createUser(e){let t=await this.getAccessToken(),a=await fetch("https://".concat(this.domain,"/api/v2/users"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({connection:"Username-Password-Authentication",...e})});if(!a.ok)throw Error("Failed to create user: ".concat(a.statusText));return a.json()}constructor(){this.accessToken=null,this.tokenExpiry=null,this.domain=T.domain,this.clientId=T.clientId,this.clientSecret=T.clientSecret}}new A,T.domain,T.clientId,T.clientSecret,T.baseURL,T.secret,T.issuerBaseURL,T.audience,T.audience;var m=a(9835);let v=(0,l.createContext)(void 0);function N(e){let{children:t}=e,{user:a,error:n,isLoading:o}=(0,c.aF)(),[i,u]=(0,l.useState)(r.QN),[d,p]=(0,l.useState)([]);(0,l.useEffect)(()=>{var e;if(null==a?void 0:null===(e=a.app_metadata)||void 0===e?void 0:e.projects){let e=a.app_metadata.projects;p(e),e.includes(i)||u(e[0]||r.QN)}else p([r.QN]),u(r.QN)},[a,i]);let _=async e=>{if(!a)throw Error("User not authenticated");try{if(!(await fetch("/api/auth/user/metadata",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to update user metadata");window.location.reload()}catch(e){throw console.error("Error updating user metadata:",e),e}},T={user:a,isLoading:o,error:n,currentProject:i,setCurrentProject:u,availableProjects:d,hasRole:e=>{var t,n;return!!a&&((null===(n=a.app_metadata)||void 0===n?void 0:null===(t=n.roles)||void 0===t?void 0:t.includes(e))||!1)},hasProjectAccess:e=>!!a&&h(a,e),isQNUser:!!a&&h(a,"qn"),isRLTRUser:!!a&&h(a,"rltr_mktg"),login:e=>{window.location.origin;let t="/api/auth/login".concat(e?"?returnTo=".concat(encodeURIComponent(e)):"");window.location.href=t},logout:()=>{window.location.href="/api/auth/logout"},updateUserMetadata:_};return(0,s.jsx)(v.Provider,{value:T,children:t})}function E(e){let{children:t}=e;return(0,s.jsx)(c.dr,{loginUrl:"/api/auth/login",profileUrl:"/api/auth/me",children:(0,s.jsx)(N,{children:t})})}m.env.AUTH0_DOMAIN,m.env.AUTH0_CLIENT_ID,m.env.AUTH0_AUDIENCE,window.location.origin;let U=e=>{let{children:t}=e;return(0,s.jsx)(E,{children:t})},f=()=>{let e=function(){let e=(0,l.useContext)(v);if(void 0===e)throw Error("useDashboardAuth must be used within a DashboardAuthProvider");return e}();return{user:e.user?{id:e.user.sub,name:e.user.name||e.user.nickname||"".concat(e.user.given_name||""," ").concat(e.user.family_name||"").trim(),role:e.hasRole(i.SUPER_ADMIN)?"admin":"user",...e.user}:null,loading:e.isLoading,login:()=>(e.login(),Promise.resolve(!0)),logout:e.logout,currentProject:e.currentProject,setCurrentProject:e.setCurrentProject,availableProjects:e.availableProjects,hasRole:e.hasRole,hasProjectAccess:e.hasProjectAccess,isQNUser:e.isQNUser,isRLTRUser:e.isRLTRUser,updateUserMetadata:e.updateUserMetadata}}},30177:function(e,t,a){a.d(t,{cn:function(){return i}});var n=a(59239),o=a(48525);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.m6)((0,n.W)(t))}}}]);